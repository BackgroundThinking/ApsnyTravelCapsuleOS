> # ApsnyTravel-CapsuleOS Algorithm - Deployment Guide

**Version:** 1.0
**Date:** December 2, 2025

---

## 1. Introduction

This guide provides instructions for deploying and running the ApsnyTravel-CapsuleOS Integration Algorithm. The algorithm is designed to be run as part of a CI/CD pipeline or manually as a build step.

---

## 2. Prerequisites

- **Python 3.11+**
- **pip** (Python package installer)

---

## 3. Installation

1.  **Navigate to the algorithm directory:**

    ```bash
    cd algorithm
    ```

2.  **Install dependencies:**

    ```bash
    pip install -r requirements.txt
    ```

---

## 4. Running the Algorithm

The algorithm is run via the `sync-with-apsnytravel.py` script located in the `scripts/` directory.

### 4.1. Manual Execution

To run the synchronization process manually, execute the following command from the root of the project:

```bash
python3 scripts/sync-with-apsnytravel.py
```

This will fetch the live data, process it through the pipeline, and generate the updated JSON files in the `client/public/` directory.

### 4.2. Integration with Build Process

The algorithm can be integrated into the `package.json` build process.

**Add the following to the `scripts` section of `package.json`:**

```json
"scripts": {
  "content:sync": "python3 scripts/sync-with-apsnytravel.py",
  "build": "pnpm content:sync && vite build"
}
```

Now, when you run `pnpm build`, the synchronization script will run first, ensuring that the application is always built with the latest content.

---

## 5. Configuration

The algorithm can be configured via environment variables.

### 5.1. Environment Variables

| Variable                 | Description                                         | Default                                |
| :----------------------- | :-------------------------------------------------- | :------------------------------------- |
| `APSNYTRAVEL_SOURCE_URL` | The URL of the live `capsules.json` file.           | `https://apsnytravel.ru/capsules.json` |
| `CAPSULEOS_OUTPUT_DIR`   | The directory to write the generated JSON files to. | `client/public/`                       |

### 5.2. `.env` File

You can create a `.env` file in the root of the project to store these variables:

```
APSNYTRAVEL_SOURCE_URL=https://your-custom-url.com/capsules.json
CAPSULEOS_OUTPUT_DIR=./my-output-dir
```

---

## 6. Logging & Troubleshooting

### 6.1. Log File

The algorithm generates a detailed log file named `algorithm.log` in the directory where it is run. This file contains a complete record of the pipeline execution, including any errors or warnings.

### 6.2. Common Issues

- **Network Errors:** Ensure that the `APSNYTRAVEL_SOURCE_URL` is accessible and that there are no network connectivity issues.
- **Data Validation Errors:** If the source data format changes, the Pydantic models in `models.py` may need to be updated.
- **Permission Errors:** Ensure that the script has write permissions to the `CAPSULEOS_OUTPUT_DIR`.

---

**Generated by:** Manus AI
